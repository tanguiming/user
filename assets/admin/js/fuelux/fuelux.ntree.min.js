(function(e,t){var n=function(t,n){this.$element=e(t),this.options=e.extend({},e.fn.tree.defaults,n),this.$element.on("click",".tree-item input",function(e){e.stopPropagation()}),this.$element.on("click",".tree-item",e.proxy(function(e){this.selectItem(e.currentTarget)},this)),this.$element.on("click",".tree-folder-header",e.proxy(function(e){this.selectFolder(e.currentTarget)},this)),this.render()};n.prototype={constructor:n,render:function(){this.populate(this.$element)},populate:function(n){var r=this,i=n.parent().find(".tree-loader:eq(0)");i.show(),this.options.dataSource.data(n.data(),function(s){i.hide(),e.each(s.data,function(e,i){var s;if(i.type==="folder"){s=r.$element.find(".tree-folder:eq(0)").clone().show(),s.find(".tree-folder-name").html(i.name),s.find(".tree-loader").html(r.options.loadingHTML);var o=s.find(".tree-folder-header");o.data(i),"icon-class"in i&&o.find('[class*="icon-"]').addClass(i["icon-class"]),r.options.allItems&&(r.populate(s.find(".tree-folder-header")),s.find(".tree-folder-content").hide())}else i.type==="item"&&(s=r.$element.find(".tree-item:eq(0)").clone().show(),s.find(".tree-item-name").html(i.name),s.data(i),i.selected!==t&&i.selected===!0&&(s.addClass("tree-selected"),s.find("i").removeClass(r.options["unselected-icon"]).addClass(r.options["selected-icon"])));n.hasClass("tree-folder-header")?n.parent().find(".tree-folder-content:eq(0)").append(s):n.append(s)}),r.$element.trigger("loaded")})},selectItem:function(t){if(this.options["selectable"]==0)return;var n=e(t),r=this.$element.find(".tree-selected"),i=[];this.options.multiSelect?e.each(r,function(t,r){var s=e(r);s[0]!==n[0]&&i.push(e(r).data())}):r[0]!==n[0]&&(r.removeClass("tree-selected").find("i").removeClass(this.options["selected-icon"]).addClass(this.options["unselected-icon"]),i.push(n.data())),n.hasClass("tree-selected")?(n.removeClass("tree-selected"),n.find("i").removeClass(this.options["selected-icon"]).addClass(this.options["unselected-icon"])):(n.addClass("tree-selected"),n.find("i").removeClass(this.options["unselected-icon"]).addClass(this.options["selected-icon"]),this.options.multiSelect&&i.push(n.data())),i.length&&this.$element.trigger("selected",{info:i})},selectFolder:function(t){var n=e(t),r=n.parent();n.find("."+this.options["close-icon"]).length?(r.find(".tree-folder-content").children().length?r.find(".tree-folder-content:eq(0)").show():this.populate(n),r.find("."+this.options["close-icon"]+":eq(0)").removeClass(this.options["close-icon"]).addClass(this.options["open-icon"]),this.$element.trigger("opened",n.data())):(this.options.cacheItems?r.find(".tree-folder-content:eq(0)").hide():r.find(".tree-folder-content:eq(0)").empty(),r.find("."+this.options["open-icon"]+":eq(0)").removeClass(this.options["open-icon"]).addClass(this.options["close-icon"]),this.$element.trigger("closed",n.data()))},selectedItems:function(){var t=this.$element.find(".tree-selected"),n=[];return e.each(t,function(t,r){n.push(e(r).data())}),n}},e.fn.tree=function(r,i){var s,o=this.each(function(){var t=e(this),o=t.data("tree"),u=typeof r=="object"&&r;o||t.data("tree",o=new n(this,u)),typeof r=="string"&&(s=o[r](i))});return s===t?o:s},e.fn.tree.defaults={multiSelect:!1,allItems:!1,loadingHTML:"<div>Loading...</div>",cacheItems:!0},e.fn.tree.Constructor=n})(window.jQuery)